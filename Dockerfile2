FROM node:alpine as builder

MAINTAINER david.zuluaga@bitsamericas.com

RUN apk update && apk add --no-cache make git
# Create app directory
WORKDIR /app
# Install app dependencies
ADD package.json /app/
RUN cd /app && npm set progress=false && npm install
# Copy project files into the docker image
ADD .  /app
RUN cd /app && npm run build
#RUN cd /app && npm run build:ssr -- --output-path=./dist/out --configuration $configuration
#RUN npm run build -- --output-path=./dist/out --configuration $configuration

FROM nginx:alpine

MAINTAINER david.zuluaga@bitsamericas.com

ADD nginx.conf /etc/nginx/nginx.conf

WORKDIR /usr/share/nginx/html

COPY --from=linuxalpine /app/dist/out/ .